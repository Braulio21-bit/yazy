
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>YAZY â€” 2 jugadores</title>
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#F39C82">
<style>
  :root{ --bg:#F39C82; --board:#2F3943; --frame:#EDE4CE; --cell:#F4E2B2; --red:#F55E59; --green:#A8D4C4; --muted:#6B7A88; --text:#1f2937; }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;color:var(--text);
       display:flex;align-items:center;justify-content:center}
  .app{width:min(760px,94vw)}
  .board{background:var(--board);border-radius:28px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
  .screen{background:var(--frame);border-radius:18px;padding:12px}
  .hud{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
  .puck{background:#fff;border-radius:999px;padding:6px 10px;font-weight:800;color:#2b3540;box-shadow:0 2px 0 rgba(0,0,0,.15)}
  .names{display:flex;gap:10px;justify-content:space-between;margin-bottom:8px}
  .names input{flex:1 1 45%; padding:8px 10px; border-radius:12px; border:2px solid #d0d7df; font-weight:800}
  table{width:100%;border-collapse:separate;border-spacing:0 10px}
  th,td{border-radius:12px;padding:10px 10px}
  th{font-size:0.95rem}
  .col-cat{background:var(--cell);width:40%}
  .col-red{background:var(--red);text-align:center;color:#fff;font-weight:900}
  .col-green{background:var(--green);text-align:center;color:#1b2a26;font-weight:900}
  .dice{display:flex;gap:8px;margin-top:8px}
  .die{width:42px;height:42px;border-radius:10px;background:#fff;display:grid;place-items:center;cursor:pointer}
  .die.held{outline:3px solid #ffd166}
  .tiles{display:grid;grid-template-columns:repeat(5,1fr);gap:18px;margin-top:18px}
  .tile{height:60px;background:#232c35;border-radius:14px;display:grid;place-items:center;
        box-shadow:inset 0 0 0 2px #3a4652, 0 4px 0 rgba(0,0,0,.25);color:#fff;font-size:22px}
  .row{display:flex;gap:10px;align-items:center;justify-content:center}
  .btn{background:#fff;border:none;border-radius:999px;padding:8px 12px;font-weight:800;cursor:pointer}
  .muted{color:var(--muted);font-size:0.9rem}
  /* Winner overlay */
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:10}
  .modal{width:min(560px,92vw);background:#fff;border-radius:22px;padding:22px;box-shadow:0 12px 40px rgba(0,0,0,.35);text-align:center;position:relative;overflow:hidden; animation:pop .25s ease-out}
  .winName{font-size:2.1rem;font-weight:900;margin:0}
  .winSub{color:#6b7280;font-size:1.05rem;margin:4px 0 12px 0}
  .btnRow{display:flex;gap:10px;justify-content:center;margin-top:10px}
  .confetti{position:absolute;inset:0;pointer-events:none}
  @keyframes pop {0%{transform:scale(.9);opacity:0}100%{transform:scale(1);opacity:1}}
</style>
</head>
<body>
  <div class="app">
    <div class="board">
      <div class="hud">
        <div class="puck">J1: <span id="score1">0</span></div>
        <div class="puck">Tiradas: <span id="rolls">3</span></div>
        <div class="puck">J2: <span id="score2">0</span></div>
      </div>

      <div class="screen">
        <div class="names">
          <input id="name1" type="text" placeholder="Nombre J1 (ej. Braulio)">
          <input id="name2" type="text" placeholder="Nombre J2 (ej. Daniel)">
        </div>

        <table id="grid">
          <thead><tr><th class="col-cat">CategorÃ­a</th><th class="col-red">J1</th><th class="col-green">J2</th></tr></thead>
          <tbody id="tbody"></tbody>
        </table>

        <div class="dice" id="dice" aria-hidden="true"></div>

        <div class="tiles"><div class="tile">â˜…</div><div class="tile">â˜…</div><div class="tile">â˜…</div><div class="tile">â˜…</div><div class="tile">â˜…</div></div>

        <div class="row" style="margin-top:10px">
          <button class="btn" id="btnRoll">TIRAR</button>
          <button class="btn" id="btnReset">DESMARCAR</button>
          <button class="btn" id="btnNew">NUEVA</button>
        </div>

        <div class="row muted" style="margin-top:8px">Toca un nÃºmero en la tabla para anotar el turno. MantÃ©n dados tocÃ¡ndolos (arriba) â€” las estrellas son decorativas.</div>
      </div>
    </div>
  </div>

  <!-- Winner overlay -->
  <div id="overlay" class="overlay" role="dialog" aria-modal="true" aria-labelledby="winTitle">
    <div class="modal">
      <canvas id="confetti" class="confetti"></canvas>
      <h2 id="winName" class="winName">Â¡Ganador!</h2>
      <div id="winSub" class="winSub"></div>
      <div id="winScores" class="muted" style="margin-bottom:8px"></div>
      <div class="btnRow">
        <button class="btn" id="btnAgain">Jugar otra</button>
        <button class="btn" id="btnClose">Cerrar</button>
      </div>
    </div>
  </div>

<script>
const cats=["Unos","Doses","Treses","Cuatres","Cincos","Seises","3 de un tipo","4 de un tipo","Full House","Esc. pequeÃ±a","Esc. grande","Yatzy","Chance"];
const UPPER_COUNT=6, UPPER_BONUS=35;
let S={dice:[1,1,1,1,1],held:[false,false,false,false,false],rolls:3,turn:0,sheet:[Array(cats.length).fill(null),Array(cats.length).fill(null)]};

// Helpers
function cnts(d){const c=[0,0,0,0,0,0,0]; d.forEach(v=>c[v]++); return c;}
function sum(d){return d.reduce((a,b)=>a+b,0);}
function score(cat,d){const c=cnts(d);
  switch(cat){
    case 0:return 1*c[1]; case 1:return 2*c[2]; case 2:return 3*c[3];
    case 3:return 4*c[4]; case 4:return 5*c[5]; case 5:return 6*c[6];
    case 6:{for(let v=1;v<=6;v++) if(c[v]>=3) return sum(d); return 0;}
    case 7:{for(let v=1;v<=6;v++) if(c[v]>=4) return sum(d); return 0;}
    case 8:return (c.some(x=>x===3)&&c.some(x=>x===2))?25:0;
    case 9:{const set=new Set(d); for(const s of [[1,2,3,4],[2,3,4,5],[3,4,5,6]]) if(s.every(v=>set.has(v))) return 30; return 0;}
    case 10:{const set=new Set(d); if([1,2,3,4,5].every(v=>set.has(v))||[2,3,4,5,6].every(v=>set.has(v))) return 40; return 0;}
    case 11:{for(let v=1;v<=6;v++) if(c[v]===5) return 50; return 0;}
    case 12:return sum(d);
  } return 0;
}
function totals(p){
  const row=S.sheet[p];
  let upper=0; for(let i=0;i<UPPER_COUNT;i++) upper+=(row[i]??0);
  const bonus=upper>=63?UPPER_BONUS:0;
  let lower=0; for(let i=UPPER_COUNT;i<cats.length;i++) lower+=(row[i]??0);
  return {upper,bonus,lower,total:upper+bonus+lower};
}

// Render dice & interactions
function renderDice(){
  const box=document.getElementById('dice'); box.innerHTML='';
  S.dice.forEach((v,i)=>{
    const d=document.createElement('div'); d.className='die'+(S.held[i]?' held':'');
    d.textContent=v; d.onclick=()=>{ if(S.rolls<3){S.held[i]=!S.held[i]; renderDice();} };
    box.appendChild(d);
  });
}

function renderSheet(){
  const tb=document.getElementById('tbody'); tb.innerHTML='';
  for(let i=0;i<cats.length;i++){
    const tr=document.createElement('tr');
    const tdCat=document.createElement('td'); tdCat.className='col-cat'; tdCat.textContent=cats[i]; tr.appendChild(tdCat);
    for(let p=0;p<2;p++){
      const td=document.createElement('td'); td.className = p===0?'col-red':'col-green';
      const val=S.sheet[p][i];
      if(val===null){
        if(p===S.turn && S.rolls<3){
          const pts=score(i,S.dice);
          td.textContent=pts; td.style.cursor='pointer';
          td.onclick=()=>{ S.sheet[p][i]=pts; endTurn(); };
        }else{ td.textContent=''; }
      }else{ td.textContent=val; }
      tr.appendChild(td);
    }
    tb.appendChild(tr);
  }
  document.getElementById('score1').textContent=totals(0).total;
  document.getElementById('score2').textContent=totals(1).total;
}

function roll(){
  if(S.rolls<=0) return;
  for(let i=0;i<5;i++){ if(!S.held[i]) S.dice[i]=1+Math.floor(Math.random()*6); }
  S.rolls--; document.getElementById('rolls').textContent=S.rolls;
  renderDice(); renderSheet();
}
function endTurn(){
  if(S.sheet[0].every(v=>v!==null) && S.sheet[1].every(v=>v!==null)){ return finish(); }
  S.turn=1-S.turn; S.rolls=3; document.getElementById('rolls').textContent=S.rolls;
  S.held=[false,false,false,false,false];
  renderDice(); renderSheet();
}
function newGame(){ S={dice:[1,1,1,1,1],held:[false,false,false,false,false],rolls:3,turn:0,sheet:[Array(cats.length).fill(null),Array(cats.length).fill(null)]};
  document.getElementById('rolls').textContent=S.rolls; renderDice(); renderSheet();
}

// Winner overlay with custom messages
const overlay=document.getElementById('overlay');
const winName=document.getElementById('winName');
const winSub=document.getElementById('winSub');
const winScores=document.getElementById('winScores');
const name1=document.getElementById('name1');
const name2=document.getElementById('name2');

function finish(){
  const t0=totals(0).total, t1=totals(1).total;
  const n1=(name1.value||'J1'), n2=(name2.value||'J2');
  let title='', sub='';
  if (t0===t1){
    title='Â¡Empate!'; sub='Buen juego ðŸŽ‰';
  } else if (t0>t1){
    title=n1; sub='Eres la Mera Caca';
  } else {
    title=n2; sub='Te fuiste';
  }
  winName.textContent=title;
  winSub.textContent=sub;
  winScores.textContent=`Marcador final â€” ${n1}: ${t0} Â· ${n2}: ${t1}`;
  showOverlay(); launchConfetti();
}

function showOverlay(){ overlay.style.display='flex'; sizeC(); }
function hideOverlay(){ overlay.style.display='none'; }
document.getElementById('btnAgain').onclick=()=>{ hideOverlay(); newGame(); }
document.getElementById('btnClose').onclick=()=>{ hideOverlay(); }

// Confetti canvas
const confetti=document.getElementById('confetti');
const cx=confetti.getContext('2d');
function sizeC(){ confetti.width=confetti.parentElement.clientWidth; confetti.height=confetti.parentElement.clientHeight; }
let pieces=[];
function launchConfetti(){
  pieces=[]; sizeC();
  for(let i=0;i<200;i++){
    pieces.push({x:Math.random()*confetti.width,y:-10-Math.random()*200,vy:2+Math.random()*3,rx:Math.random()*6,size:6+Math.random()*10,color:`hsl(${Math.random()*360},90%,60%)`});
  }
  (function anim(){
    cx.clearRect(0,0,confetti.width,confetti.height);
    pieces.forEach(p=>{ p.y+=p.vy; p.rx+=0.1; cx.save(); cx.translate(p.x,p.y); cx.rotate(p.rx); cx.fillStyle=p.color; cx.fillRect(-p.size/2,-p.size/2,p.size,p.size); cx.restore(); });
    if (overlay.style.display==='flex' && pieces.some(p=>p.y<confetti.height+20)) requestAnimationFrame(anim);
  })();
}

// Events
document.getElementById('btnRoll').onclick=roll;
document.getElementById('btnReset').onclick=()=>{S.held=[false,false,false,false,false]; renderDice();};
document.getElementById('btnNew').onclick=newGame;

newGame();
if('serviceWorker' in navigator){window.addEventListener('load',()=>navigator.serviceWorker.register('./sw.js').catch(()=>{}));}
</script>
</body>
</html>
