
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>YAZYMV</title>
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#F39C82">
<style>
  body{margin:0;font-family:sans-serif;background:#f39c82;display:flex;justify-content:center;align-items:center;min-height:100vh}
  .app{width:min(820px,96vw)}
  h1{text-align:center;margin-bottom:10px;font-size:2rem;color:#2f3943}
  .board{background:#2f3943;border-radius:20px;padding:15px;color:#fff;box-shadow:0 10px 30px rgba(0,0,0,.3)}
  .names{display:flex;gap:10px;margin-bottom:10px}
  .names input{flex:1;padding:8px;border-radius:10px;border:2px solid #ddd;font-weight:bold}
  .hud{display:flex;justify-content:space-between;margin-bottom:10px}
  .dice{display:flex;gap:10px;justify-content:center;margin:10px 0}
  .die{width:60px;height:60px;background:#fff;border-radius:12px;display:grid;place-items:center;position:relative;box-shadow:0 4px 6px rgba(0,0,0,.4);transition:transform .3s}
  .die.held{outline:4px solid gold}
  .pip{width:12px;height:12px;background:#000;border-radius:50%;position:absolute}
  .row{display:flex;justify-content:center;gap:10px;margin-top:10px}
  .btn{padding:8px 14px;border:none;border-radius:999px;font-weight:bold;cursor:pointer}
  table{width:100%;margin-top:10px;border-collapse:collapse;background:#fff;color:#000}
  th,td{padding:6px;border:1px solid #555;text-align:center}
  th{background:#ddd}
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:10}
  .modal{background:#fff;border-radius:20px;padding:20px;text-align:center;animation:pop .4s ease}
  .modal h2{font-size:2rem;margin:0;background:linear-gradient(45deg,#f39c82,#f55e59);-webkit-background-clip:text;color:transparent}
  .modal p{margin:6px 0 12px;font-weight:bold}
  @keyframes pop{0%{transform:scale(.7);opacity:0}100%{transform:scale(1);opacity:1}}
  .shake{animation:shake .5s}
  @keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-5px)}50%{transform:translateX(5px)}75%{transform:translateX(-5px)}100%{transform:translateX(0)}}
</style>
</head>
<body>
<div class="app">
  <h1>YAZYMV</h1>
  <div class="board">
    <div class="names">
      <input id="name1" placeholder="Nombre J1">
      <input id="name2" placeholder="Nombre J2">
    </div>
    <div class="hud">
      <div>J1: <span id="score1">0</span></div>
      <div>Tiradas: <span id="rolls">3</span></div>
      <div>J2: <span id="score2">0</span></div>
    </div>
    <div class="dice" id="dice"></div>
    <div class="row">
      <button class="btn" id="btnRoll">TIRAR</button>
      <button class="btn" id="btnReset">DESMARCAR</button>
      <button class="btn" id="btnNew">NUEVA</button>
    </div>
    <table><thead><tr><th>Categoría</th><th>J1</th><th>J2</th></tr></thead><tbody id="tbody"></tbody></table>
  </div>
</div>

<div class="overlay" id="overlay">
  <div class="modal" id="modal">
    <h2 id="winName"></h2>
    <p id="winSub"></p>
    <p id="winScores"></p>
    <button class="btn" id="btnAgain">Jugar otra</button>
  </div>
</div>

<audio id="sndRoll" src="roll.wav"></audio>
<audio id="sndWin" src="win.wav"></audio>

<script>
const cats=["Unos","Doses","Treses","Cuatres","Cincos","Seises","3 de un tipo","4 de un tipo","Full House","Esc. pequeña","Esc. grande","Yatzy","Chance"];
const UPPER_COUNT=6, UPPER_BONUS=35;
let S={dice:[1,1,1,1,1],held:[false,false,false,false,false],rolls:3,turn:0,sheet:[Array(cats.length).fill(null),Array(cats.length).fill(null)]};

function cnts(d){const c=[0,0,0,0,0,0,0]; d.forEach(v=>c[v]++); return c;}
function sum(d){return d.reduce((a,b)=>a+b,0);}
function score(cat,d){const c=cnts(d);
  switch(cat){
    case 0:return 1*c[1]; case 1:return 2*c[2]; case 2:return 3*c[3];
    case 3:return 4*c[4]; case 4:return 5*c[5]; case 5:return 6*c[6];
    case 6:{for(let v=1;v<=6;v++) if(c[v]>=3) return sum(d); return 0;}
    case 7:{for(let v=1;v<=6;v++) if(c[v]>=4) return sum(d); return 0;}
    case 8:return (c.some(x=>x===3)&&c.some(x=>x===2))?25:0;
    case 9:{const set=new Set(d); for(const s of [[1,2,3,4],[2,3,4,5],[3,4,5,6]]) if(s.every(v=>set.has(v))) return 30; return 0;}
    case 10:{const set=new Set(d); if([1,2,3,4,5].every(v=>set.has(v))||[2,3,4,5,6].every(v=>set.has(v))) return 40; return 0;}
    case 11:{for(let v=1;v<=6;v++) if(c[v]===5) return 50; return 0;}
    case 12:return sum(d);
  } return 0;
}
function totals(p){
  const row=S.sheet[p]; let upper=0; for(let i=0;i<UPPER_COUNT;i++) upper+=(row[i]??0);
  const bonus=upper>=63?UPPER_BONUS:0; let lower=0; for(let i=UPPER_COUNT;i<cats.length;i++) lower+=(row[i]??0);
  return {upper,bonus,lower,total:upper+bonus+lower};
}

function renderDice(){
  const box=document.getElementById('dice'); box.innerHTML='';
  S.dice.forEach((v,i)=>{
    const d=document.createElement('div'); d.className='die'+(S.held[i]?' held':'');
    d.onclick=()=>{ if(S.rolls<3){S.held[i]=!S.held[i]; renderDice();} };
    drawPips(d,v);
    box.appendChild(d);
  });
}
function drawPips(el,val){
  el.innerHTML='';
  const coords={
    1:[[50,50]],
    2:[[20,20],[80,80]],
    3:[[20,20],[50,50],[80,80]],
    4:[[20,20],[80,20],[20,80],[80,80]],
    5:[[20,20],[80,20],[50,50],[20,80],[80,80]],
    6:[[20,20],[80,20],[20,50],[80,50],[20,80],[80,80]]
  };
  coords[val].forEach(c=>{
    const p=document.createElement('div'); p.className='pip'; p.style.left=c[0]*0.6-6+'px'; p.style.top=c[1]*0.6-6+'px';
    el.appendChild(p);
  });
}

function renderSheet(){
  const tb=document.getElementById('tbody'); tb.innerHTML='';
  for(let i=0;i<cats.length;i++){
    const tr=document.createElement('tr');
    const tdCat=document.createElement('td'); tdCat.textContent=cats[i]; tr.appendChild(tdCat);
    for(let p=0;p<2;p++){
      const td=document.createElement('td'); const val=S.sheet[p][i];
      if(val===null){
        if(p===S.turn && S.rolls<3){
          const pts=score(i,S.dice);
          td.textContent=pts; td.style.cursor='pointer';
          td.onclick=()=>{ S.sheet[p][i]=pts; endTurn(); };
        }else td.textContent='';
      } else td.textContent=val;
      tr.appendChild(td);
    }
    tb.appendChild(tr);
  }
  document.getElementById('score1').textContent=totals(0).total;
  document.getElementById('score2').textContent=totals(1).total;
}

function roll(){
  if(S.rolls<=0) return;
  const snd=document.getElementById('sndRoll'); snd.currentTime=0; snd.play();
  let t=0; const interval=setInterval(()=>{
    for(let i=0;i<5;i++){ if(!S.held[i]) S.dice[i]=1+Math.floor(Math.random()*6); }
    renderDice();
    if(++t>6){clearInterval(interval);}
  },100);
  S.rolls--; document.getElementById('rolls').textContent=S.rolls;
  setTimeout(renderSheet,800);
}

function endTurn(){
  if(S.sheet[0].every(v=>v!==null)&&S.sheet[1].every(v=>v!==null)){finish();return;}
  S.turn=1-S.turn; S.rolls=3; document.getElementById('rolls').textContent=S.rolls; S.held=[false,false,false,false,false];
  renderDice(); renderSheet();
}
function newGame(){ S={dice:[1,1,1,1,1],held:[false,false,false,false,false],rolls:3,turn:0,sheet:[Array(cats.length).fill(null),Array(cats.length).fill(null)]}; document.getElementById('rolls').textContent=S.rolls; renderDice(); renderSheet(); }

function finish(){
  const t0=totals(0).total,t1=totals(1).total;
  const n1=document.getElementById('name1').value||'J1';
  const n2=document.getElementById('name2').value||'J2';
  let title,sub;
  if(t0===t1){title='¡Empate!';sub='';}
  else if(t0>t1){title=n1;sub='Eres la Mera Caca';}
  else{title=n2;sub='Te fuiste';}
  document.getElementById('winName').textContent=title;
  document.getElementById('winSub').textContent=sub;
  document.getElementById('winScores').textContent=`Marcador final — ${n1}: ${t0} · ${n2}: ${t1}`;
  document.getElementById('overlay').style.display='flex';
  const modal=document.getElementById('modal'); modal.classList.add('shake');
  setTimeout(()=>modal.classList.remove('shake'),600);
  const snd=document.getElementById('sndWin'); snd.currentTime=0; snd.play();
}

document.getElementById('btnRoll').onclick=roll;
document.getElementById('btnReset').onclick=()=>{S.held=[false,false,false,false,false]; renderDice();};
document.getElementById('btnNew').onclick=newGame;
document.getElementById('btnAgain').onclick=()=>{document.getElementById('overlay').style.display='none'; newGame();};

newGame();
</script>
</body>
</html>
